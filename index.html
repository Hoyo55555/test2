<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç®¡é®‘ä¹‹äº¤)</title>
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <!-- Babel: Used to interpret JSX inside the <script type="text/babel"> tag -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+TC:wght@500;700;900&family=Ma+Shan+Zheng&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --wood-dark: #3e2723;
            --wood-light: #8d6e63;
            --paper-bg: #fffbf0;
            --gold-accent: #ffb300;
        }

        body {
            font-family: 'Noto Serif TC', serif;
            background-color: #f3eed8;
            background-image: url("https://www.transparenttextures.com/patterns/aged-paper.png");
            color: var(--wood-dark);
            overflow: hidden;
            height: 100vh;
            width: 100vw;
            margin: 0;
        }

        /* å­—é«”è¨­å®š */
        .font-art { font-family: 'Ma Shan Zheng', cursive; }

        /* é€šç”¨æœ¨è³ªæŒ‰éˆ• */
        .btn-wood {
            background: linear-gradient(to bottom, #8d6e63, #5d4037);
            border: 3px solid #3e2723;
            color: #fff8e1;
            box-shadow: 0 4px 0 #2d1b18, 0 5px 10px rgba(0,0,0,0.3);
            transition: all 0.1s;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            cursor: pointer;
        }
        .btn-wood:hover {
            filter: brightness(1.15);
            transform: translateY(-2px);
            box-shadow: 0 6px 0 #2d1b18, 0 8px 15px rgba(0,0,0,0.3);
            border-color: #5d4037;
        }
        .btn-wood:active {
            transform: translateY(2px);
            box-shadow: 0 2px 0 #2d1b18, 0 2px 5px rgba(0,0,0,0.3);
        }
        .btn-wood.active {
            background: linear-gradient(to bottom, #ffb74d, #ffa726);
            color: #3e2723;
            border-color: #bf360c;
            box-shadow: inset 0 2px 5px rgba(0,0,0,0.2), 0 2px 0 #e65100;
        }

        /* å¡ç‰‡é¢æ¿ */
        .card-panel {
            background-color: #fff8e1;
            border: 4px solid #5d4037;
            border-radius: 16px;
            box-shadow: 4px 4px 0px rgba(62, 39, 35, 0.2), 0 8px 16px rgba(0,0,0,0.15);
            transition: transform 0.2s;
            position: relative;
            overflow: hidden;
        }
        .card-panel:hover {
            transform: translateY(-5px);
            border-color: #ffb74d;
        }

        /* å°è¦½åˆ— */
        .nav-container {
            background-image: url("https://www.transparenttextures.com/patterns/wood-pattern.png");
            background-color: #4e342e;
            border-bottom: 5px solid #ffb74d;
            box-shadow: 0 4px 10px rgba(0,0,0,0.4);
            z-index: 50;
            position: relative;
            display: flex;
            align-items: center;
        }

        /* === æ•…äº‹åŠ‡å ´ä½ˆå±€ === */
        
        .full-text-area {
            position: absolute;
            top: 80px;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #fffbf0;
            padding: 40px;
            padding-bottom: 300px;
            overflow-y: auto;
            z-index: 1;
            scrollbar-width: thin;
            scrollbar-color: #8d6e63 #fffbf0;
        }

        .text-content {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            padding: 50px;
            border-radius: 8px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05);
            border: 1px solid #e0e0e0;
            position: relative;
        }

        .interaction-layer {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 280px;
            z-index: 10;
            pointer-events: none;
            display: flex;
            justify-content: center;
            align-items: flex-end;
            padding-bottom: 30px;
        }

        /* === åœ“å½¢é ­åƒæ¨£å¼ === */
        .avatar-frame {
            width: 180px;
            height: 180px;
            border-radius: 50%;
            border: 6px solid #d4af37;
            box-shadow: 
                0 0 0 4px #5d4037,
                0 10px 20px rgba(0,0,0,0.5),
                inset 0 0 20px rgba(0,0,0,0.3);
            overflow: hidden;
            background: #fff8e1;
            position: relative;
            z-index: 30;
            transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        .avatar-frame.speaking {
            transform: scale(1.15) translateY(-10px);
            border-color: #ffb300;
            box-shadow: 
                0 0 0 4px #5d4037,
                0 0 30px rgba(255, 179, 0, 0.6);
        }

        .avatar-frame.silent {
            transform: scale(0.9);
            filter: grayscale(0.6) brightness(0.7);
            border-color: #8d6e63;
        }

        .avatar-svg {
            width: 100%;
            height: 100%;
        }

        .char-container {
            position: absolute;
            bottom: 50px; 
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .char-left { left: 12%; transform: translateX(-50%); }
        .char-right { right: 12%; transform: translateX(50%); }

        .name-badge {
            margin-top: -15px;
            background: #3e2723;
            color: #ffb300;
            padding: 6px 20px;
            border-radius: 20px;
            font-weight: bold;
            font-size: 1.2rem;
            border: 2px solid #ffb300;
            z-index: 40;
            position: relative;
            box-shadow: 0 4px 6px rgba(0,0,0,0.3);
        }

        .dialogue-box {
            width: 60%;
            min-width: 800px;
            background: rgba(255, 255, 255, 0.95);
            border: 5px solid #3e2723;
            border-radius: 24px;
            padding: 30px 45px;
            margin-bottom: 35px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            pointer-events: auto;
            position: relative;
            z-index: 25;
            display: flex;
            flex-direction: column;
            justify-content: center;
            min-height: 160px;
        }

        .typewriter::after { content: '|'; animation: blink 1s step-start infinite; }
        @keyframes blink { 50% { opacity: 0; } }

        .practice-card {
            background-color: white;
            border: 4px solid #8d6e63;
            border-radius: 16px;
            padding: 2rem;
            box-shadow: 0 6px 12px rgba(0,0,0,0.1);
            height: 100%;
            display: flex;
            flex-direction: column;
            transition: transform 0.2s;
        }
        .practice-card:hover {
            border-color: #d4af37;
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.15);
        }

        .fade-in { animation: fadeIn 0.5s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>

    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // -----------------------
        // è‡ªå®šç¾© SVG è§’è‰²çµ„ä»¶ (è§£æ±ºåœ–ç‰‡è·¯å¾‘å•é¡Œ)
        // -----------------------
        const GuanAvatar = () => (
            // åš´è‚…è—è¡£å®˜å“¡
            <svg viewBox="0 0 200 200" className="avatar-svg">
                <defs>
                    <linearGradient id="skinGrad" x1="0%" y1="0%" x2="100%" y2="100%">
                        <stop offset="0%" stopColor="#fde0c4" />
                        <stop offset="100%" stopColor="#f5cba7" />
                    </linearGradient>
                    <linearGradient id="clothBlue" x1="0%" y1="0%" x2="100%" y2="100%">
                        <stop offset="0%" stopColor="#4299e1" />
                        <stop offset="100%" stopColor="#2b6cb0" />
                    </linearGradient>
                </defs>
                {/* èƒŒæ™¯ */}
                <circle cx="100" cy="100" r="100" fill="#ebf8ff" />
                {/* èº«é«”/è¡£æœ */}
                <path d="M40 200 Q100 160 160 200 L160 200 L40 200 Z" fill="url(#clothBlue)" />
                <path d="M40 200 Q100 160 160 200" fill="none" stroke="#2c5282" strokeWidth="4" />
                {/* é ˜å£ */}
                <path d="M85 180 L100 200 L115 180" fill="#fff" />
                {/* é ­éƒ¨ */}
                <circle cx="100" cy="110" r="45" fill="url(#skinGrad)" stroke="#d69e2e" strokeWidth="2" />
                {/* å®˜å¸½ */}
                <path d="M70 90 L130 90 L125 50 L75 50 Z" fill="#2d3748" />
                <rect x="60" y="85" width="80" height="15" rx="5" fill="#1a202c" />
                <circle cx="100" cy="70" r="5" fill="#f6e05e" />
                {/* å¸½ç¿… */}
                <path d="M60 90 L30 80 M140 90 L170 80" stroke="#1a202c" strokeWidth="6" strokeLinecap="round" />
                {/* äº”å®˜ (åš´è‚…) */}
                <path d="M85 115 Q100 110 115 115" fill="none" stroke="#718096" strokeWidth="2" />
                <circle cx="85" cy="105" r="3" fill="#2d3748" />
                <circle cx="115" cy="105" r="3" fill="#2d3748" />
                <path d="M80 98 L95 95 M120 98 L105 95" stroke="#2d3748" strokeWidth="2" />
                {/* é¬å­ */}
                <path d="M95 125 L100 140 L105 125" fill="#2d3748" />
            </svg>
        );

        const BaoAvatar = () => (
            // æº«å’Œæ£•è‰²å®˜å“¡
            <svg viewBox="0 0 200 200" className="avatar-svg">
                <defs>
                    <linearGradient id="skinGrad2" x1="0%" y1="0%" x2="100%" y2="100%">
                        <stop offset="0%" stopColor="#ffe4cc" />
                        <stop offset="100%" stopColor="#f0c294" />
                    </linearGradient>
                    <linearGradient id="clothBrown" x1="0%" y1="0%" x2="100%" y2="100%">
                        <stop offset="0%" stopColor="#d69e2e" />
                        <stop offset="100%" stopColor="#975a16" />
                    </linearGradient>
                </defs>
                {/* èƒŒæ™¯ */}
                <circle cx="100" cy="100" r="100" fill="#fffff0" />
                {/* èº«é«”/è¡£æœ */}
                <path d="M40 200 Q100 160 160 200 L160 200 L40 200 Z" fill="url(#clothBrown)" />
                <path d="M40 200 Q100 160 160 200" fill="none" stroke="#744210" strokeWidth="4" />
                {/* é ˜å£ */}
                <path d="M85 180 L100 200 L115 180" fill="#fff" />
                {/* é ­éƒ¨ */}
                <circle cx="100" cy="110" r="45" fill="url(#skinGrad2)" stroke="#b7791f" strokeWidth="2" />
                {/* å®˜å¸½ */}
                <path d="M75 90 L125 90 L120 55 L80 55 Z" fill="#2d3748" />
                <rect x="65" y="85" width="70" height="15" rx="5" fill="#1a202c" />
                <circle cx="100" cy="75" r="5" fill="#63b3ed" />
                {/* å¸½ç¿… (ä¸‹å‚è¡¨ç¤ºæº«å’Œ) */}
                <path d="M65 92 Q40 100 30 95 M135 92 Q160 100 170 95" stroke="#1a202c" strokeWidth="5" strokeLinecap="round" />
                {/* äº”å®˜ (æº«å’Œå¾®ç¬‘) */}
                <path d="M90 120 Q100 125 110 120" fill="none" stroke="#718096" strokeWidth="2" />
                <circle cx="85" cy="105" r="3" fill="#2d3748" />
                <circle cx="115" cy="105" r="3" fill="#2d3748" />
                <path d="M80 95 Q90 90 95 95 M120 95 Q110 90 105 95" stroke="#2d3748" strokeWidth="1.5" />
                {/* é¬å­ */}
                <path d="M98 128 Q100 135 102 128" fill="none" stroke="#2d3748" strokeWidth="1" />
            </svg>
        );

        // -----------------------
        // æ•…äº‹è³‡æ–™
        // -----------------------
        const STORY_CHAPTERS = [
            {
                id: 1,
                title: "ä¸€ã€è²§è³¤ä¹‹äº¤",
                content: `æ˜¥ç§‹æ™‚æœŸï¼Œé½Šåœ‹çš„ç®¡ä»²å’Œé®‘å”ç‰™è‡ªå¹´å°‘æ™‚å³ç‚ºå¥½å‹ã€‚ç®¡ä»²å®¶è£¡è²§çª®ï¼Œé‚„è¦å¥‰é¤Šè€æ¯è¦ªï¼Œç”Ÿæ´»ååˆ†å›°é “ã€‚\n\nå…©äººæ›¾ç¶“åˆå¤¥åšç”Ÿæ„ï¼Œæœ¬éŒ¢å¤§éƒ½æ˜¯é®‘å”ç‰™å‡ºçš„ï¼Œä½†è³ºäº†éŒ¢åˆ†ç´…æ™‚ï¼Œç®¡ä»²å»ç¸½æ˜¯è‡ªå·±å¤šåˆ†ä¸€äº›ï¼Œåªåˆ†çµ¦é®‘å”ç‰™å°‘éƒ¨åˆ†ã€‚æ—äººçœ‹äº†éƒ½æ›¿é®‘å”ç‰™æŠ±ä¸å¹³ï¼Œèªªç®¡ä»²è²ªå¿ƒã€‚\n\nä½†é®‘å”ç‰™å»æ›¿ä»–è§£é‡‹èªªï¼šã€Œç®¡ä»²ä¸æ˜¯è²ªè²¡ï¼Œæ˜¯å› ç‚ºä»–å®¶è£¡çª®ï¼Œéœ€è¦éŒ¢é¤Šå®¶æ´»å£ï¼Œæˆ‘é«”è«’ä»–çš„è™•å¢ƒï¼Œé€™æ˜¯æˆ‘è‡ªé¡˜è®“çµ¦ä»–çš„ã€‚ã€`,
                dialogue: [
                    { speaker: "ç®¡ä»²", isGuan: true, text: "é®‘å…„...é€™æ¬¡åˆ†ç´…æˆ‘åˆå¤šæ‹¿äº†ï¼ŒçœŸæ˜¯ä¸å¥½æ„æ€ï¼Œå®¶è£¡è€æ¯è¦ªç”Ÿç—…éœ€è¦éŒ¢..." },
                    { speaker: "é®‘å”ç‰™", isGuan: false, text: "ç®¡å¼Ÿåˆ¥é€™éº¼èªªï¼æˆ‘çŸ¥é“ä½ æœ‰å›°é›£ã€‚æˆ‘å€‘æ˜¯å…„å¼Ÿï¼ŒéŒ¢è²¡ä¹ƒèº«å¤–ä¹‹ç‰©ï¼Œä½ çš„å­å¿ƒæ¯”é»ƒé‡‘æ›´çè²´å•Šï¼" },
                    { speaker: "æ—äºº", isGuan: false, isNPC: true, text: "(ç«Šç«Šç§èª) é‚£å€‹ç®¡ä»²çœŸè²ªå¿ƒï¼Œæœ¬éŒ¢æ²’å‡ºå¤šå°‘ï¼ŒéŒ¢å€’æ‹¿æŒºå¤š..." },
                    { speaker: "é®‘å”ç‰™", isGuan: false, text: "ä½å£ï¼ä½ å€‘ä¸æ‡‚ã€‚ç®¡ä»²æ˜¯å¤§æ‰ï¼Œåªæ˜¯æ™‚é‹ä¸æ¿Ÿï¼Œæˆ‘è‹¥æ˜¯è¨ˆè¼ƒé€™äº›éŒ¢ï¼Œè±ˆä¸æ˜¯ä¾®iculateäº†æˆ‘å€‘çš„äº¤æƒ…ï¼Ÿ" }
                ]
            },
            {
                id: 2,
                title: "äºŒã€ä¸€ç®­ä¹‹ä»‡",
                content: `å¾Œä¾†é½Šåœ‹å…§äº‚ï¼Œå…¬å­å€‘ç´›ç´›å¤–é€ƒã€‚ç®¡ä»²è¼”ä½å…¬å­ç³¾é€ƒå¾€é­¯åœ‹ï¼Œé®‘å”ç‰™å‰‡è¼”ä½å…¬å­å°ç™½é€ƒå¾€è’åœ‹ã€‚\n\nè€åœ‹å›æ­»å¾Œï¼Œå…©ä½å…¬å­éƒ½è¦çˆ­å¥ªç‹ä½ã€‚ç®¡ä»²ç‚ºäº†å¹«åŠ©å…¬å­ç³¾ï¼Œä¾¿å¸¶å…µåœ¨åŠè·¯æ””æˆªå…¬å­å°ç™½ï¼Œä¸¦å°„äº†ä¸€ç®­ã€‚é€™ä¸€ç®­æ­£å¥½å°„ä¸­å…¬å­å°ç™½è…°å¸¶ä¸Šçš„å¸¶é‰¤ï¼ˆéŠ…é‰¤ï¼‰ï¼Œå°ç™½æ€¥ä¸­ç”Ÿæ™ºï¼Œé †å‹¢å€’åœ°è£æ­»ï¼Œé¨™éäº†ç®¡ä»²ã€‚\n\nç®¡ä»²ä»¥ç‚ºå°ç™½å·²æ­»ï¼Œä¾¿è­·é€å…¬å­ç³¾æ…¢æ…¢å›åœ‹ã€‚æ²’æƒ³åˆ°å°ç™½æ—©å·²æ—¥å¤œå…¼ç¨‹è¶•å›é½Šåœ‹ï¼Œæ¶å…ˆå³ä½ï¼Œæˆç‚ºäº†å¾Œä¾†çš„ã€Œé½Šæ¡“å…¬ã€ã€‚`,
                dialogue: [
                    { speaker: "ç®¡ä»²", isGuan: true, text: "(æ‹‰å¼“ç„æº–) ç‚ºäº†å…¬å­ç³¾çš„å¤§æ¥­ï¼Œå°ç™½å…¬å­ï¼Œå°ä¸ä½äº†ï¼(å’»â€”â€”)" },
                    { speaker: "é®‘å”ç‰™", isGuan: false, text: "(é©šå‘¼) å°ç™½å…¬å­ï¼... ä»€éº¼ï¼Ÿå°„ä¸­å¸¶é‰¤ï¼Ÿå¿«ï¼Œå…¬å­å¿«è£æ­»ï¼Œé€™æ˜¯å”¯ä¸€çš„æ©Ÿæœƒï¼" },
                    { speaker: "ç®¡ä»²", isGuan: true, text: "çœ‹ä»–å€’ä¸‹äº†ï¼Œæ‡‰è©²æ˜¯æ­»äº†ã€‚æˆ‘å€‘æ…¢æ…¢å›åœ‹å³å¯ï¼Œå¤§å±€å·²å®šã€‚" },
                    { speaker: "é®‘å”ç‰™", isGuan: false, text: "ç®¡ä»²å•Šç®¡ä»²ï¼Œä½ é›–ç„¶ç¥å°„ï¼Œä½†å¤©å‘½é›£é•ã€‚é€™æ¬¡æ˜¯æˆ‘è´äº†ï¼Œæˆ‘å€‘è¦å¿«é¦¬åŠ é­è¶•å›é½Šåœ‹ï¼" }
                ]
            },
            {
                id: 3,
                title: "ä¸‰ã€é®‘å”ç‰™è–¦è³¢",
                content: `é½Šæ¡“å…¬å³ä½å¾Œï¼Œè¦å ±é€™ä¸€ç®­ä¹‹ä»‡ï¼Œæ±ºå®šæ®ºæ­»ç®¡ä»²ã€‚é€™æ™‚ï¼Œèº«ç‚ºå¤§åŠŸè‡£çš„é®‘å”ç‰™ç«™äº†å‡ºä¾†ï¼Œæ¥µåŠ›å‹¸é˜»ã€‚\n\né®‘å”ç‰™å°é½Šæ¡“å…¬èªªï¼šã€Œæ‚¨å¦‚æœåªæƒ³æ²»ç†å¥½é½Šåœ‹ï¼Œç”¨æˆ‘å’Œé«˜å‚’å…©äººå°±å¤ äº†ï¼›ä½†å¦‚æœæ‚¨æƒ³ç¨±éœ¸è«¸ä¾¯ã€åŒ¡æ­£å¤©ä¸‹ï¼Œéç”¨ç®¡ä»²ä¸å¯ï¼ç®¡ä»²ä¹‹æ‰ï¼Œé å‹æ–¼æˆ‘ã€‚ã€\n\né½Šæ¡“å…¬è½äº†é®‘å”ç‰™çš„è©±ï¼Œæ±ºå®šæ”¾ä¸‹ç§ä»‡ï¼Œé‡ç”¨ç®¡ä»²ã€‚`,
                dialogue: [
                    { speaker: "é½Šæ¡“å…¬", isGuan: false, isNPC: true, text: "ç®¡ä»²é‚£å‚¢ä¼™å·®é»å°„æ­»å¯¡äººï¼æˆ‘ä¸€å®šè¦æ®ºäº†ä»–å ±ä»‡ï¼" },
                    { speaker: "é®‘å”ç‰™", isGuan: false, text: "ä¸»å…¬æ¯æ€’ï¼è‹¥æ‚¨åªæƒ³æ²»ç†é½Šåœ‹ï¼Œç”¨æˆ‘å°±å¤ äº†ï¼›ä½†è‹¥æƒ³ç¨±éœ¸å¤©ä¸‹ï¼Œéç®¡ä»²ä¸å¯ï¼" },
                    { speaker: "é½Šæ¡“å…¬", isGuan: false, isNPC: true, text: "ä»€éº¼ï¼Ÿä»–å¯æ˜¯æˆ‘çš„ä»‡äººï¼Œè€Œä¸”ä½ æ˜¯å¤§åŠŸè‡£ï¼Œå®°ç›¸æ‡‰è©²æ˜¯ä½ åšå•Šï¼" },
                    { speaker: "é®‘å”ç‰™", isGuan: false, text: "æˆ‘çš„æ‰èƒ½ä¸å¦‚ç®¡ä»²ã€‚ä»–æ˜¯æ²»ç†åœ‹å®¶çš„æ£Ÿæ¨‘ï¼Œæˆ‘é¡˜æ„é€€å±…å…¶ä¸‹ï¼Œè«‹ä¸»å…¬å‹™å¿…é‡ç”¨ä»–ï¼" }
                ]
            },
            {
                id: 4,
                title: "å››ã€çŸ¥éŸ³åƒå¤",
                content: `é½Šæ¡“å…¬æ‹œç®¡ä»²ç‚ºå®°ç›¸ï¼Œå°Šç¨±ç‚ºã€Œä»²çˆ¶ã€ã€‚ç®¡ä»²åœ¨é½Šåœ‹é€²è¡Œå¤§åˆ€é—Šæ–§çš„æ”¹é©ï¼Œå¯Œåœ‹å¼·å…µï¼Œæœ€çµ‚çœŸçš„è¼”ä½é½Šæ¡“å…¬æˆç‚ºæ˜¥ç§‹äº”éœ¸ä¹‹é¦–ï¼Œå®Œæˆäº†éœ¸æ¥­ã€‚\n\nå›é¦–é€™æ®µå¾€äº‹ï¼Œç®¡ä»²æ›¾æ„Ÿå˜†é“ï¼šã€Œç”Ÿæˆ‘è€…çˆ¶æ¯ï¼ŒçŸ¥æˆ‘è€…é®‘å­ä¹Ÿã€‚ã€ï¼ˆç”Ÿé¤Šæˆ‘çš„æ˜¯çˆ¶æ¯ï¼Œä½†çœŸæ­£äº†è§£æˆ‘ã€æˆå…¨æˆ‘çš„ï¼Œå»æ˜¯é®‘å”ç‰™å•Šï¼ï¼‰\n\né€™æ®µæ•…äº‹ï¼Œä¾¿æˆäº†å¾Œä¸–æµå‚³åƒå¤çš„ã€Œç®¡é®‘ä¹‹äº¤ã€ã€‚`,
                dialogue: [
                    { speaker: "ç®¡ä»²", isGuan: true, text: "æ²’æƒ³åˆ°æˆ‘ä¸€å€‹æ•—è»ä¹‹å°‡ï¼Œé‚„èƒ½ç•¶ä¸Šå®°ç›¸... é®‘å…„ï¼Œé€™å…¨æ˜¯å› ç‚ºä½ å•Šã€‚" },
                    { speaker: "é®‘å”ç‰™", isGuan: false, text: "(å¾®ç¬‘) çœ‹åˆ°ä½ æ–½å±•æ‰è¯ï¼Œè®“ç™¾å§“å¯Œè¶³ï¼Œæˆ‘æ¯”è‡ªå·±ç•¶å®°ç›¸é‚„é«˜èˆˆã€‚" },
                    { speaker: "ç®¡ä»²", isGuan: true, text: "å”‰ï¼ç”Ÿæˆ‘è€…çˆ¶æ¯ï¼ŒçŸ¥æˆ‘è€…é®‘å­ä¹Ÿï¼é€™è¼©å­èƒ½äº¤åˆ°ä½ é€™å€‹æœ‹å‹ï¼Œæ­»è€Œç„¡æ†¾äº†ã€‚" },
                    { speaker: "é®‘å”ç‰™", isGuan: false, text: "é€™å°±æ˜¯ã€Œç®¡é®‘ä¹‹äº¤ã€ï¼Œé¡˜æˆ‘å€‘çš„æ•…äº‹èƒ½æµå‚³åƒå¤ï¼Œè®“å¾ŒäººçŸ¥é“ä»€éº¼æ˜¯çœŸæ­£çš„æœ‹å‹ã€‚" }
                ]
            }
        ];

        // -----------------------
        // ç·´ç¿’é¡Œè³‡æ–™
        // -----------------------
        const PRACTICE_TASKS = [
            {
                id: 1,
                title: "ä»»å‹™ä¸€ï¼šå–®é¸æŒ‘æˆ°",
                type: "choice_group",
                questions: [
                    {
                        q: "1. åˆå¤¥åšç”Ÿæ„æ™‚ï¼Œé®‘å”ç‰™ç‚ºä½•ä¸è¨ˆè¼ƒç®¡ä»²å¤šæ‹¿éŒ¢ï¼Ÿ",
                        opts: ["ç®¡ä»²å¾ˆå…‡", "é«”è«’ç®¡ä»²å®¶è²§", "é®‘å”ç‰™ç®—è¡“ä¸å¥½"],
                        ans: 1
                    },
                    {
                        q: "2. ç®¡ä»²å°„ä¸­é½Šæ¡“å…¬çš„ä»€éº¼éƒ¨ä½ï¼Ÿ",
                        opts: ["é ­ç›”", "å¸¶é‰¤ (è…°å¸¶é‰¤)", "æ‰‹è‡‚"],
                        ans: 1
                    },
                    {
                        q: "3. é®‘å”ç‰™æ¨è–¦ç®¡ä»²æ“”ä»»ä»€éº¼è·ä½ï¼Ÿ",
                        opts: ["å¤§å°‡è»", "å®°ç›¸", "è²¡æ”¿å¤§è‡£"],
                        ans: 1
                    }
                ]
            },
            {
                id: 2,
                title: "ä»»å‹™äºŒï¼šé–‹æ”¾æ€è€ƒ",
                type: "open_group",
                questions: [
                    {
                        q: "1. å¦‚æœä½ æ˜¯é®‘å”ç‰™ï¼Œä½ æœƒæ¨è–¦æ›¾ç¶“æ®ºéä½ ä¸»å…¬çš„äººå—ï¼Ÿ",
                        ref: "åƒè€ƒï¼šæœƒ/ä¸æœƒã€‚è‹¥ä»¥åœ‹å®¶åˆ©ç›Šç‚ºé‡ï¼Œæ‡‰åƒé®‘å”ç‰™ä¸€æ¨£æ”¾ä¸‹ç§ä»‡ï¼Œä»»ç”¨äººæ‰ã€‚"
                    },
                    {
                        q: "2. ã€Œç”Ÿæˆ‘è€…çˆ¶æ¯ï¼ŒçŸ¥æˆ‘è€…é®‘å­ä¹Ÿã€é€™å¥è©±æ˜¯ä»€éº¼æ„æ€ï¼Ÿ",
                        ref: "åƒè€ƒï¼šçˆ¶æ¯çµ¦æˆ‘ç”Ÿå‘½ï¼Œä½†çœŸæ­£äº†è§£æˆ‘ã€æˆå…¨æˆ‘çš„äººæ˜¯é®‘å”ç‰™ã€‚æ„Ÿå˜†çŸ¥éŸ³é›£å°‹ã€‚"
                    },
                    {
                        q: "3. ä½ èªç‚ºç¾ä»£ç¤¾æœƒé‚„æ‰¾å¾—åˆ°ã€Œç®¡é®‘ä¹‹äº¤ã€å—ï¼Ÿç‚ºä»€éº¼ï¼Ÿ",
                        ref: "åƒè€ƒï¼š(è‡ªç”±ç™¼æ®) é›–ç„¶ç¾ä»£äººè¼ƒåŠŸåˆ©ï¼Œä½†åªè¦çœŸå¿ƒå¾…äººï¼Œä¾ç„¶æœ‰çœŸæ‘¯çš„å‹èª¼ã€‚"
                    }
                ]
            }
        ];

        // -----------------------
        // ä¸»ç¨‹å¼
        // -----------------------
        function App() {
            const [tab, setTab] = useState('HOME');
            const [selectedChapter, setSelectedChapter] = useState(null);
            const [selectedTask, setSelectedTask] = useState(null);
            const [dialogueStep, setDialogueStep] = useState(0);
            const [answers, setAnswers] = useState({});
            const [showRef, setShowRef] = useState({});

            useEffect(() => {
                let timer;
                if (selectedChapter) {
                    const chapter = STORY_CHAPTERS.find(c => c.id === selectedChapter);
                    timer = setInterval(() => {
                        setDialogueStep(prev => {
                            if (prev >= chapter.dialogue.length - 1) {
                                return 0; // å¾ªç’°
                            }
                            return prev + 1;
                        });
                    }, 6000); 
                } else {
                    setDialogueStep(0);
                }
                return () => clearInterval(timer);
            }, [selectedChapter]);

            // å°è¦½åˆ—
            const renderNav = () => (
                <div className="nav-container h-24 flex justify-center items-center gap-8 sticky top-0 px-4">
                    <button onClick={() => setTab('HOME')} className={`btn-wood px-10 py-3 rounded-full font-bold text-2xl tracking-wide ${tab === 'HOME' ? 'active' : ''}`}>
                        <span>ğŸ“º</span> å½±éŸ³å°è®€
                    </button>
                    <button onClick={() => {setTab('STORY'); setSelectedChapter(null);}} className={`btn-wood px-10 py-3 rounded-full font-bold text-2xl tracking-wide ${tab === 'STORY' ? 'active' : ''}`}>
                        <span>ğŸ“–</span> æ•…äº‹åŠ‡å ´
                    </button>
                    <button onClick={() => {setTab('PRACTICE'); setSelectedTask(null);}} className={`btn-wood px-10 py-3 rounded-full font-bold text-2xl tracking-wide ${tab === 'PRACTICE' ? 'active' : ''}`}>
                        <span>ğŸ“</span> æ€è€ƒèˆ‡ç·´ç¿’
                    </button>
                </div>
            );

            // é¦–é 
            const renderHome = () => (
                <div className="flex flex-col items-center justify-center h-[calc(100vh-96px)] fade-in">
                    <h1 className="text-9xl font-art text-amber-900 mb-10 drop-shadow-xl tracking-widest text-stroke">ç®¡é®‘ä¹‹äº¤</h1>
                    <div className="p-4 bg-black rounded-2xl border-8 border-[#5d4037] shadow-2xl relative">
                         <div className="absolute top-3 left-3 w-5 h-5 bg-[#8d6e63] rounded-full shadow-inner"></div>
                         <div className="absolute top-3 right-3 w-5 h-5 bg-[#8d6e63] rounded-full shadow-inner"></div>
                         <div className="absolute bottom-3 left-3 w-5 h-5 bg-[#8d6e63] rounded-full shadow-inner"></div>
                         <div className="absolute bottom-3 right-3 w-5 h-5 bg-[#8d6e63] rounded-full shadow-inner"></div>
                         
                        <iframe 
                            width="960" height="540" 
                            src="https://www.youtube.com/embed/_nFtWKUrISI?start=78" 
                            title="YouTube video player" 
                            frameBorder="0" 
                            allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" 
                            allowFullScreen
                            className="rounded block"
                        ></iframe>
                    </div>
                    <p className="mt-8 text-2xl text-amber-900 font-bold bg-white/50 px-8 py-3 rounded-full shadow-sm">
                        è«‹é»é¸ä¸Šæ–¹æŒ‰éˆ•é–‹å§‹èª²ç¨‹
                    </p>
                </div>
            );

            // æ•…äº‹åŠ‡å ´
            const renderStory = () => {
                if (!selectedChapter) {
                    return (
                        <div className="h-[calc(100vh-96px)] flex flex-col justify-center items-center fade-in px-8">
                            <h2 className="text-6xl font-art text-amber-900 mb-16 border-b-4 border-amber-800 pb-4 px-12">è«‹é¸æ“‡æ•…äº‹ç¯‡ç« </h2>
                            <div className="grid grid-cols-4 gap-10 w-full max-w-[90%]">
                                {STORY_CHAPTERS.map((chap, index) => (
                                    <button 
                                        key={chap.id}
                                        onClick={() => setSelectedChapter(chap.id)}
                                        className="card-panel h-96 flex flex-col items-center justify-center p-6 cursor-pointer hover:scale-105 group"
                                    >
                                        <div className="text-9xl mb-6 font-bold text-amber-900/10 group-hover:text-amber-600/20 transition-colors font-serif">{index + 1}</div>
                                        <h3 className="text-4xl font-bold text-amber-900 mb-4">{chap.title.split('ã€')[1]}</h3>
                                        <span className="text-amber-700 opacity-0 group-hover:opacity-100 transition-opacity mt-4 font-bold text-xl">é»æ“Šé–±è®€ â¤</span>
                                    </button>
                                ))}
                            </div>
                        </div>
                    );
                }

                const chapter = STORY_CHAPTERS.find(c => c.id === selectedChapter);
                const currentLine = chapter.dialogue[dialogueStep];
                
                const isGuanSpeaking = currentLine.speaker === "ç®¡ä»²";
                const isBaoSpeaking = !isGuanSpeaking && currentLine.speaker !== "æ—äºº" && currentLine.speaker !== "é½Šæ¡“å…¬"; 

                return (
                    <div className="story-container fade-in relative h-[calc(100vh-96px)]">
                        
                        {/* 1. èª²æ–‡å·è»¸é–±è®€å€ */}
                        <div className="full-text-area">
                            <div className="text-content">
                                <button 
                                    onClick={() => setSelectedChapter(null)}
                                    className="mb-8 inline-block btn-wood px-8 py-3 rounded-lg font-bold text-xl"
                                >
                                    â¬… è¿”å›é¸å–®
                                </button>
                                <h2 className="text-6xl font-bold text-amber-900 mb-10 text-center border-b-4 border-double border-amber-200 pb-6">{chapter.title}</h2>
                                <p className="text-4xl leading-[2.5] text-gray-900 text-justify font-bold whitespace-pre-line px-8 tracking-wider">
                                    {chapter.content}
                                </p>
                            </div>
                        </div>

                        {/* 2. åº•éƒ¨äº’å‹•å±¤ */}
                        <div className="interaction-layer">
                            
                            {/* å·¦å´è§’è‰²: ç®¡ä»² */}
                            <div className="char-container char-left">
                                <div className={`avatar-frame ${isGuanSpeaking ? 'speaking' : 'silent'}`}>
                                    <GuanAvatar />
                                </div>
                                <div className="name-badge">ç®¡ä»²</div>
                            </div>

                            {/* ä¸­é–“å°è©±æ¡† */}
                            <div className="dialogue-box">
                                <div className="text-3xl font-bold text-amber-800 mb-2 border-b border-amber-200 pb-1 inline-block w-fit">
                                    {currentLine.speaker} èªªï¼š
                                </div>
                                {/* é—œéµä¿®æ­£ï¼šå°è©±æ–‡å­—å¾ text-4xl ç¸®å°åˆ° text-3xl */}
                                <div className="text-3xl font-bold text-gray-800 typewriter leading-relaxed mt-2">
                                    {currentLine.text}
                                </div>
                            </div>

                            {/* å³å´è§’è‰²: é®‘å”ç‰™ */}
                            <div className="char-container char-right">
                                <div className={`avatar-frame ${isBaoSpeaking ? 'speaking' : 'silent'}`}>
                                    <BaoAvatar />
                                </div>
                                <div className="name-badge">é®‘å”ç‰™</div>
                            </div>

                        </div>

                    </div>
                );
            };

            // ç·´ç¿’é¡Œ
            const renderPractice = () => {
                if (!selectedTask) {
                    return (
                        <div className="h-[calc(100vh-96px)] flex flex-col justify-center items-center fade-in px-8">
                            <h2 className="text-6xl font-art text-amber-900 mb-20 border-b-4 border-amber-800 pb-4 px-12">è«‹é¸æ“‡æŒ‘æˆ°ä»»å‹™</h2>
                            <div className="grid grid-cols-2 gap-20 w-full max-w-6xl">
                                {PRACTICE_TASKS.map((task) => (
                                    <button 
                                        key={task.id}
                                        onClick={() => setSelectedTask(task.id)}
                                        className="card-panel h-96 flex flex-col items-center justify-center p-8 cursor-pointer hover:scale-105 group"
                                    >
                                        <div className="text-9xl mb-8 transform group-hover:scale-110 transition-transform">
                                            {task.type === 'choice_group' ? 'âœ…' : 'ğŸ’¡'}
                                        </div>
                                        <h3 className="text-6xl font-bold text-amber-900">{task.title}</h3>
                                    </button>
                                ))}
                            </div>
                        </div>
                    );
                }

                const task = PRACTICE_TASKS.find(t => t.id === selectedTask);

                return (
                    <div className="h-[calc(100vh-96px)] p-8 fade-in flex flex-col w-[95%] mx-auto">
                        <div className="flex justify-between items-center mb-6 flex-shrink-0">
                            <h2 className="text-5xl font-bold text-amber-900 border-l-8 border-amber-800 pl-6">{task.title}</h2>
                            <button 
                                onClick={() => setSelectedTask(null)}
                                className="btn-wood px-8 py-3 rounded-lg font-bold text-2xl"
                            >
                                â¬… è¿”å›é¸å–®
                            </button>
                        </div>

                        <div className="grid grid-cols-3 gap-8 pb-6 flex-grow h-full overflow-hidden">
                            {task.questions.map((q, idx) => (
                                <div key={idx} className="practice-card">
                                    <div className="font-bold text-3xl mb-6 text-amber-900 bg-amber-100 px-6 py-2 rounded-lg w-fit border border-amber-300">
                                        é¡Œç›® {idx + 1}
                                    </div>
                                    <p className="text-4xl font-bold text-gray-800 mb-8 leading-relaxed">{q.q}</p>

                                    {task.type === 'choice_group' && (
                                        <div className="flex flex-col gap-4 mt-auto">
                                            {q.opts.map((opt, oIdx) => {
                                                const qKey = `${task.id}-${idx}`; 
                                                const isSelected = answers[qKey] === oIdx;
                                                const isCorrect = oIdx === q.ans;
                                                return (
                                                    <button 
                                                        key={oIdx}
                                                        onClick={() => setAnswers({...answers, [qKey]: oIdx})}
                                                        className={`w-full text-left p-6 rounded-xl border-4 font-bold text-3xl transition-all ${isSelected ? (isCorrect ? 'bg-green-100 border-green-600 text-green-900' : 'bg-red-100 border-red-600 text-red-900') : 'bg-white border-gray-200 hover:bg-amber-50 hover:border-amber-300 text-gray-700'}`}
                                                    >
                                                        {String.fromCharCode(65+oIdx)}. {opt}
                                                        {isSelected && (isCorrect ? ' â­•' : ' âŒ')}
                                                    </button>
                                                )
                                            })}
                                        </div>
                                    )}

                                    {task.type === 'open_group' && (
                                        <div className="flex flex-col gap-6 mt-auto flex-grow">
                                            <textarea className="w-full flex-grow p-6 border-2 border-gray-300 rounded-xl bg-gray-50 text-3xl focus:outline-none focus:border-amber-500 shadow-inner resize-none" placeholder="è«‹è¼¸å…¥çœ‹æ³•..."></textarea>
                                            <button 
                                                onClick={() => setShowRef(prev => ({...prev, [`${task.id}-${idx}`]: !prev[`${task.id}-${idx}`]}))}
                                                className="bg-amber-600 text-white py-4 rounded-xl font-bold hover:bg-amber-700 text-3xl shadow-md flex-shrink-0"
                                            >
                                                {showRef[`${task.id}-${idx}`] ? 'éš±è—åƒè€ƒ' : 'ğŸ’¡ çœ‹åƒè€ƒç­”æ¡ˆ'}
                                            </button>
                                            {showRef[`${task.id}-${idx}`] && (
                                                <div className="bg-yellow-50 p-6 rounded-xl text-amber-900 font-bold border-2 border-yellow-300 text-2xl shadow-sm animate-pulse flex-shrink-0">
                                                    {q.ref}
                                                </div>
                                            )}
                                        </div>
                                    )}
                                </div>
                            ))}
                        </div>
                    </div>
                );
            };

            return (
                <div style={{height: '100vh', display: 'flex', flexDirection: 'column'}}>
                    {renderNav()}
                    <div style={{flex: 1, overflow: 'hidden'}}>
                        {tab === 'HOME' && renderHome()}
                        {tab === 'STORY' && renderStory()}
                        {tab === 'PRACTICE' && renderPractice()}
                    </div>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
